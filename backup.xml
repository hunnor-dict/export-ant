<?xml version="1.0" encoding="UTF-8"?>
<project name="hunnor-backup-ant" default="backup">

	<description>Backup the dictionary database.</description>

	<!-- Load sensitive information (e.g. passwords) from a properties file -->
	<property file="project.properties"/>

	<!-- Define the location of target directories and tools -->
	<property name="project.dir" location="/opt/hunnor-dict"/>
	<property name="dropbox.backup" location="${project.dir}/Dropbox/Backup"/>
	<property name="dropbox.public" location="${project.dir}/Dropbox/Public"/>
	<property name="dropbox.public.databases" location="${dropbox.public}/Databases"/>

	<target name="week.of.year">
		<tstamp>
			<format property="week" pattern="w"/>
		</tstamp>
	</target>

	<target name="backup" depends="week.of.year">
		<exec executable="mysqldump" output="hunnor.MySQL.${week}.sql">
			<arg line="-u hunnor hunnor hn_hun_segment hn_hun_tr_nob_tmp hn_nob_segment hn_nob_tr_hun_tmp"></arg>
		</exec>
		<gzip src="hunnor.MySQL.${week}.sql" destfile="hunnor.MySQL.${week}.sql.gz"/>
		<delete file="hunnor.MySQL.${week}.sql"/>
		<copy file="hunnor.MySQL.${week}.sql.gz" tofile="${dropbox.public.databases}/HunNor-MySQL.sql.gz"/>
		<move file="hunnor.MySQL.${week}.sql.gz" todir="${dropbox.backup}"/>
	</target>

</project>
